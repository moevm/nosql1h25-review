{% load static %}

<header style="background-color: black; color: white; padding: 1rem;">
    <div style="display: flex; align-items: center; margin: 0 20px">
        <!-- Логотип и Games -->
        <div style="display: flex; align-items: center; flex-grow: 1;">
            <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 2rem; font-weight: bold; margin-right: 3rem;">
                <img src="{% static 'img/logo.png' %}" alt="Logo" style="width: 70px; height: 70px;">
                <a class="navbar-brand" href="{% url 'core:homepage' %}">RottenScores</a>
            </div>
            
            <nav style="margin-right: auto;">
                <a href="{% url 'games:game_list' %}" style="color: #FFBD3F; text-decoration: none; font-size: 1.2rem; margin-right: 2rem;">Games</a>
            </nav>
        </div>

        <!-- Поиск и кнопка -->
        <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div style="position: relative;">
                <input type="text" placeholder="Search"
                    style="width: 200px; padding: 0.5rem 2rem 0.5rem 0.75rem; border-radius: 0.25rem; border: none;">
                <img src="{% static 'img/search.png' %}" alt="Search"
                    style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px;">
            </div>
            {% if user.is_authenticated %}
        <!-- Иконка пользователя для авторизованных -->
                <a href="{% url 'users:profile' %}" style="display: flex; align-items: center;">
                    <img src="{% static 'img/user.png' %}" alt="Profile"
                    style="width: 32px; height: 32px; border-radius: 50%;">
                </a>
            {% else %}
        <!-- Кнопка входа для неавторизованных -->
                <button id="authButton" style="background-color: #FFBD3F; color: black; border: none; border-radius: 0.25rem; padding: 0.5rem 1.5rem; cursor: pointer; font-weight: bold; white-space: nowrap;">
                    Authorization
                </button>
            {% endif %}
    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background-color: #1a1a1a; padding: 2rem; border-radius: 0.5rem; width: 400px; max-width: 90%;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="margin: 0; color: white;">Login</h2>
            <button id="closeModal" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>

        <form id="loginForm" method="post" action="{% url 'users:login' %}">
            {% csrf_token %}
            <div style="margin-bottom: 1rem;">
                <input type="email" name="username" placeholder="Email" required
                    style="width: 100%; padding: 0.75rem; border-radius: 0.25rem; border: 1px solid #333; background-color: #2a2a2a; color: white;">
            </div>
            <div style="margin-bottom: 1.5rem;">
                <input type="password" name="password" placeholder="Password" required
                    style="width: 100%; padding: 0.75rem; border-radius: 0.25rem; border: 1px solid #333; background-color: #2a2a2a; color: white;">
            </div>
            <button type="submit"
                    style="width: 100%; padding: 0.75rem; background-color: #FFBD3F; color: black; border: none; border-radius: 0.25rem; font-weight: bold; cursor: pointer;">
                Login
            </button>
        </form>
    </div>
</div>

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // Открытие модального окна
    document.getElementById('authButton').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('loginModal').style.display = 'flex';
    });

    // Закрытие модального окна
    document.getElementById('closeModal').addEventListener('click', function() {
        document.getElementById('loginModal').style.display = 'none';
    });

    // Закрытие при клике вне модального окна
    document.getElementById('loginModal').addEventListener('click', function(e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    });

    // AJAX отправка формы
    $(document).ready(function() {
        $('#loginForm').on('submit', function(e) {
            e.preventDefault();

            $.ajax({
                type: 'POST',
                url: $(this).attr('action'),
                data: $(this).serialize(),
                success: function(response) {
                    if (response.success) {
                        const userIconPath = "{% static 'img/user.png' %}";
                        $('#authButton').replaceWith(
                            `<a href="/profile/" style="display: flex; align-items: center;">
                                <img src="${userIconPath}" alt="Profile"
                                style="width: 32px; height: 32px; border-radius: 50%;">
                            </a>`
                        );

                        $('#loginModal').hide();


                        // Если нужно перенаправить
                        if (response.redirect_url) {
                            window.location.href = response.redirect_url;
                        }
                    } else {
                        alert(response.error || 'Ошибка входа');
                    }
                },
                error: function(xhr, status, error) {
                    alert('Произошла ошибка: ' + error);
                }
            });
        });
    });
</script>
        </div>
    </div>
</header>
